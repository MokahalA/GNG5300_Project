<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>My Recipes</title>
        <!-- Add Bootstrap CSS -->
        <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
        <!-- Add Font Awesome for the refresh icon -->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
        <style>
            table {
                width: 100%;
                border-collapse: collapse;
            }

            th, td {
                padding: 10px;
                text-align: left;
                border: 1px solid #ddd;
            }

            th {
                background-color: #f2f2f2;
            }

            .button {
                padding: 5px 10px;
                margin: 5px;
                cursor: pointer;
                border: none;
                border-radius: 5px;
                text-align: center;
            }

            .view-button {
                background-color: #4CAF50;
                color: white;
            }

            .delete-button {
                background-color: #f44336;
                color: white;
            }

            /* Refresh button styles */
            .refresh-button {
                background-color: transparent;
                color: #465361;
                border: 1px solid #465361;
                border-radius: 60%;
                padding: 10px;
                font-size: 16px;
                cursor: pointer;
                margin-left: 15px;
            }

            .refresh-button:hover {
                background-color: #c1c3c5;
                color: white;
            }
        </style>
    </head>
    <body>
        <h1 class="display-4">My Recipes
            <!-- Refresh button next to the heading -->
            <button class="refresh-button" onclick="loadRecipes()">
                <i class="fas fa-sync-alt"></i>
            </button>
        </h1>
        <br>
        <div class="container">
            <table id="recipe-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Recipe Name</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Recipes will be dynamically added here -->
                </tbody>
            </table>
        </div>

        <!-- Bootstrap Modal -->
        <div class="modal fade" id="recipeModal" tabindex="-1" role="dialog" aria-labelledby="recipeModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="recipeModalLabel">Recipe</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <h3 id="recipe-name"></h3>
                        <br>
                        <p><strong>Ingredients:</strong></p>
                        <ul id="recipe-ingredients"></ul>
                        <p><strong>Steps:</strong></p>
                        <ol id="recipe-steps"></ol>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Bootstrap JS -->
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script> <!-- Full jQuery version -->
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

        <script>
            // Function to fetch and display recipes
            function loadRecipes() {
                fetch('getRecipes/', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch recipes');
                    }
                    return response.json();
                })
                .then(data => {
                    const recipeTable = document.getElementById('recipe-table').getElementsByTagName('tbody')[0];
                    recipeTable.innerHTML = ''; // Clear current table rows

                    // Loop through the recipes and display them in the table
                    data.recipes.forEach(recipe => {
                        const row = document.createElement('tr');

                        // Create table cells for the recipe name and action buttons
                        const idCell = document.createElement('td');
                        idCell.textContent = recipe.id;

                        const nameCell = document.createElement('td');
                        nameCell.textContent = recipe.name;

                        const actionsCell = document.createElement('td');
                        const viewButton = document.createElement('button');
                        viewButton.classList.add('button', 'view-button');
                        viewButton.textContent = 'View';
                        viewButton.onclick = () => viewRecipe(recipe);

                        const deleteButton = document.createElement('button');
                        deleteButton.classList.add('button', 'delete-button');
                        deleteButton.textContent = 'Delete';
                        deleteButton.onclick = () => deleteRecipe(recipe);

                        actionsCell.appendChild(viewButton);
                        actionsCell.appendChild(deleteButton);

                        // Append the cells to the row
                        row.appendChild(idCell);
                        row.appendChild(nameCell);
                        row.appendChild(actionsCell);

                        // Append the row to the table
                        recipeTable.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('There was an error fetching the recipes.');
                });
            }

            //Add a function to delete a recipe (POST request)


            //Add a function to view a recipe (GET request and display in a modal)



            // Load the recipes when the page is loaded
            window.onload = loadRecipes;
        </script>
    </body>
</html>
